
- [EasySwapSync工程，扫链功能如何只扫我们指定的链的数?](#easyswapsync工程扫链功能如何只扫我们指定的链的数)
	- [1. 配置指定链信息](#1-配置指定链信息)
	- [2. 初始化链客户端和同步器](#2-初始化链客户端和同步器)
- [如何只扫指定合约的事件呢？](#如何只扫指定合约的事件呢)

# EasySwapSync工程，扫链功能如何只扫我们指定的链的数?


要指定扫描特定链的数据，主要涉及配置和初始化两个关键步骤：

## 1. 配置指定链信息
在 `EasySwapSync/service/config/config.go` 中定义了链配置结构：
```go
type ChainCfg struct {
    Name string `toml:"name" mapstructure:"name" json:"name"`
    ID   int64  `toml:"id" mapstructure:"id" json:"id"`
}
```

## 2. 初始化链客户端和同步器
在 `EasySwapSync/service/service.go` 的 New 函数中：
```go
// 创建区块链客户端
chainClient, err = chainclient.New(int(cfg.ChainCfg.ID), cfg.AnkrCfg.HttpsUrl+cfg.AnkrCfg.ApiKey)
if err != nil {
    return nil, errors.Wrap(err, "failed on create evm client")
}

// 根据链 ID 初始化订单簿同步器
switch cfg.ChainCfg.ID {
case chain.EthChainID, chain.OptimismChainID, chain.SepoliaChainID:
    orderbookSyncer = orderbookindexer.New(ctx, cfg, db, kvStore, chainClient, cfg.ChainCfg.ID, cfg.ChainCfg.Name, orderManager)
}
```

要指定扫描特定链的数据，需要：
1. 在配置文件中设置正确的 ChainCfg.ID（链ID）和 ChainCfg.Name（链名称）
2. 确保该链ID在 switch case 中有对应的处理逻辑
3. 配置正确的 AnkrCfg.HttpsUrl 和 ApiKey 用于连接该链的节点

这样同步器就会只扫描指定链的数据。

# 如何只扫指定合约的事件呢？


要只扫描指定合约的事件，需要在 FilterQuery 中指定合约地址。在 `EasySwapSync/service/orderbookindexer/service.go` 中可以看到相关实现：

```go
query := types.FilterQuery{
    FromBlock: new(big.Int).SetUint64(startBlock),
    ToBlock:   new(big.Int).SetUint64(endBlock),
    Addresses: []string{s.cfg.ContractCfg.DexAddress}, // 指定合约地址
}
```

这里通过 `Addresses` 字段指定了要监听的合约地址 `s.cfg.ContractCfg.DexAddress`，这样只会获取该合约发出的事件日志。

在配置文件中需要设置：
1. ChainCfg.ID - 指定要扫描的链ID
2. ContractCfg.DexAddress - 指定要监听的合约地址

这样就能实现：
- 只扫描指定链上的数据
- 只处理指定合约发出的事件
- 忽略其他合约的事件日志

> 通过这种方式，可以精确控制要监听的合约，避免处理不相关的事件。

